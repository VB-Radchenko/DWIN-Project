#ifndef __DWIN_H
#define __DWIN_H

//==============================================================================
//---------------------------------Includes-------------------------------------
//==============================================================================
#ifdef STM32L476xx
#include "stm32l4xx_hal.h"
#endif
#include <stdbool.h>
//==============================================================================
//---------------------------------Defines--------------------------------------
//==============================================================================
#define DWIN_UART huart4

#define DWIN_UART_BUFFER_SIZE 400
#define CUVE_DATA_LEN		  64
//==============================================================================
//--------------------------------Variables-------------------------------------
//==============================================================================
typedef enum 
{
  none = 0x00,
  writeReg = 0x80,
  readReg = 0x81,
  writeVariable = 0x82,
  readVariable = 0x83
}commandDWIN;


struct parsingDataDWIN_P
{
  uint16_t header;
  uint8_t length;
  commandDWIN command;
  uint8_t data[249];
};

struct readDataDWIN_P{
     uint16_t uartBuffer[DWIN_UART_BUFFER_SIZE];
     uint16_t uartCnt;
     uint8_t GettingByte;
     bool PacketReady;
     uint16_t delayOverflowMaxTime;
     uint16_t lengthRxPacket;
     bool timeoutOverflow;
     uint8_t rxData[DWIN_UART_BUFFER_SIZE];
     uint16_t timeoutDelay;
     struct parsingDataDWIN_P parsingDataDWIN;
  } ;

struct curveDataDWIN_p{
	bool CurveEnable0;
	bool CurveEnable1;
	bool CurveEnable2;
	bool CurveEnable3;
	bool CurveEnable4;
	bool CurveEnable5;
	bool CurveEnable6;
	bool CurveEnable7;

	uint8_t CurveLenData0;
	uint8_t CurveLenData1;
	uint8_t CurveLenData2;
	uint8_t CurveLenData3;
	uint8_t CurveLenData4;
	uint8_t CurveLenData5;
	uint8_t CurveLenData6;
	uint8_t CurveLenData7;


	uint16_t CurveData0[CUVE_DATA_LEN];
	uint16_t CurveData1[CUVE_DATA_LEN];
	uint16_t CurveData2[CUVE_DATA_LEN];
	uint16_t CurveData3[CUVE_DATA_LEN];
	uint16_t CurveData4[CUVE_DATA_LEN];
	uint16_t CurveData5[CUVE_DATA_LEN];
	uint16_t CurveData6[CUVE_DATA_LEN];
	uint16_t CurveData7[CUVE_DATA_LEN];
};
//==============================================================================
//--------------------------------PROTOTYPE-------------------------------------
//==============================================================================


//==============================================================================
//--------------------------------FUNCTIONS-------------------------------------
//==============================================================================
void dwinUartDmaInit();
void writeLedDWIN(uint8_t ledWork, uint8_t ledSleep);
void writeVariableDWIN(uint8_t len, uint16_t adress, uint8_t* data);
void writeHalfWordDWIN(uint16_t adress, uint16_t data);
void writeWordDWIN(uint16_t adress, uint32_t data);
void writeDoubleWordDWIN(uint16_t adress, uint64_t data);
void readVariableDWIN(uint16_t adress, uint8_t lenHalfWord);
void goToPageDWIN(uint16_t page);
void receivingDataPacket();
void parsingDWIN();
void writeOneCurveDWIN(uint8_t ChanelCurve, uint8_t lenData, uint16_t* data);
void writeCurveDWIN(struct curveDataDWIN_p curveDataDWIN);
//==============================================================================
//---------------------------------END FILE-------------------------------------
//==============================================================================
#endif /* __DWIN_H */
